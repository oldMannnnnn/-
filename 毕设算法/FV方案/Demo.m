clear
clc

syms x;

%d=16; x^16+1
d=16;
dmod=zeros(1,d+1);
dmod(1)=1;
dmod(d+1)=1;
t=19;
q=9999;

%私钥s
%s=x^15-x^13-x^12-x^11-x^9+x^8+x^6-x^4+x^2+x-1;
%s=[-1     1     1     0    -1     0     1     0     1    -1     0    -1    -1    -1     0     1];
s=[1     0    -1    -1    -1     0    -1     1     0     1     0    -1     0     1     1    -1];


%随机多项式，用于生成公钥
%a=42*x^15-256*x^14-393*x^13-229*x^12+447*x^11-369*x^10-212*x^9+107*x^8+52*x^7+70*x^6-138*x^5+322*x^4+186*x^3-282*x^2-60*x+84;
%a=[84   -60  -282   186   322  -138    70    52   107  -212  -369   447  -229  -393  -256    42];
a=[42  -256  -393  -229   447  -369  -212   107    52    70  -138   322   186  -282   -60    84];

%a=-a;

%噪音多项式
%e=-3*x^15+x^14+x^13+7*x^12-6*x^11-6*x^10+x^9+4*x^8-x^6+3*x^5-4*x^4+4*x^3+4*x+1;
%e=[1     4     0     4    -4     3    -1     0     4     1    -6    -6     7     1     1    -3];
e=[-3     1     1     7    -6    -6     1     4     0    -1     3    -4     4     0     4     1];

[Q,R]=deconv(conv(-a,s),dmod);
r=R(1,16:31);
pk0=myMod(e+r,q)
pk1=a;







%消息 3-3*x^3
m=[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 9];







%两个噪音多项式
e1=[-5 -2 3 -1 -4 3 1 4 4 5 -4 -3 -3 2 -6 4];
e2=[-7 2 -4 5 0 2 -1 4 -4 -3 2 -2 1 -4 -2 2];

%另一个多项式u
u=[0 1 1 1 0 0 0 -1 0 0 -1 0 -1 0 0 1];

[Q1,R1]=deconv(conv(pk0,u),dmod)
R1=R1(1,16:31);
ct0=R1+e1+conv((q/t),m);
ct0=round(myMod(ct0,q))

[Q2,R2]=deconv(conv(pk1,u),dmod);
R2=R2(1,16:31);
ct1=myMod(R2+e2,q)


[QQ,RR]=deconv(conv(ct1,s),dmod);
RR=RR(1,16:31);
round(myMod(RR+ct0,q)/(q/t))



